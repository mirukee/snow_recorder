# 프로젝트 정체성 (Project Identity)
- 프로젝트명: Snow Record (스노우 레코드)
- 핵심 가치: '감성(Vibe)'과 'Flex'. 사용자가 스키장에서 자신의 기록을 힙하게 확인하고 공유하는 도구.
- AI Agent 답변은 항상 한국어로 작성할 것

# 기술 스택 및 아키텍처 (Tech Stack)
- 플랫폼: iOS Native (Target iOS 17.0 이상), SwiftUI.
- 아키텍처: MVVM 패턴.
- 데이터 저장: Local-First (SwiftData).
    - 주요 모델: `RunSession` (주행 기록), `SlopeDatabase` (슬로프 정보).
- 핵심 프레임워크: 
    - CoreLocation (GPS/상태 기반 트래킹), 
    - MapKit (경로 시각화/커스텀 오버레이), 
    - SwiftData (영속성), 
    - PhotosUI/ShareLink (이미지 합성 및 공유), 
    - CoreMotion (기압계 - 고도 보정),
    - Charts (Swift Charts - 속도 그래프).

# 디자인 시스템 (Design System)
- **컨셉:** Cyberpunk / Near Future.
- **컬러 팔레트:**
    - Background: Real Black (#000000) ~ Dark Gray (#121212)
    - Primary Point: Neon Green (#6BF906)
- **타이포그래피:** SF Pro Heavy (헤드라인), SF Pro Rounded (데이터/숫자).
- **디자인 원칙:** AI(Stitch)가 제안한 디자인 시안을 픽셀 퍼펙트하게 구현. Bento Grid 레이아웃 활용.

# 로컬라이제이션 전략 (Hybrid)
- 라벨(Labels): 영어 (MAX SPEED, DISTANCE, RUN COUNT 등) - 힙한 느낌 강조.
- 데이터(Content): 한국어 우선 (하이원 리조트 - 제우스 2, 밸리 허브 등 / 런 시작 시간 등).

# 코딩 규칙 (Coding Rules)
- **모든 주석과 설명은 '한국어'로 작성한다.**
- **데이터 흐름:** `LocationManager`(상태/센서) -> `RecordManager`(세션/런 로직) -> `SwiftData`(저장) -> `Views`(표시).
- **배터리 최적화:**
    - `Riding`: 최고 정확도 (kCLLocationAccuracyBestForNavigation).
    - `Paused`: 고정밀 (kCLLocationAccuracyNearestTenMeters).
    - `OnLift`: 저전력 (kCLLocationAccuracyHundredMeters) + Sticky Logic + 리프트 하차 예측 부스트.
    - `Resting`: 고정밀 (kCLLocationAccuracyNearestTenMeters) - 빠른 리프트/이동 감지.

# 현재 개발 현황 (Implemented Features)

## 1. 핵심 트래킹 엔진 (Core Tracking)
- **상태 인식 알고리즘:** Riding / Paused / OnLift / Resting 4단계 자동 감지.
- **정밀 측정:**
    - GPS 기반 속도, 거리, 경로 기록.
    - **Barometer(기압계) 통합:** `CMAltimeter`를 활용한 정밀 Vertical Drop(하강 고도) 측정 및 GPS 고도 Drift 보정.
    - **Pending State Logic:** 상태 전환 시 Buffer(Pending Riding/Rest)를 두어 노이즈(잠깐의 멈춤 등) 필터링.
    - **Run(런) 정의:** 라이딩 시작 ~ 끝을 하나의 'Run'으로 그룹화, 최소 거리/속도 조건으로 유효 런 판정.

## 2. 슬로프 및 위치 인식 (Slope & Location)
- **Geo-Fencing DB:** 하이원 리조트 주요 슬로프(Zeus, Apollo, Hera 등) 및 리프트 좌표 DB (`SlopeDatabase`).
- **자동 감지:** 현재 위치 기반 슬로프명/구간 자동 매핑.
- **경로 분석:** 런별 주행 슬로프, 리프트 탑승 구간 분리 기록.

## 3. 고도화된 메트릭 & 스코어링 (Advanced Metrics)
- **Technical Score (Edge Score, 1000점 만점):**
    - 카빙(Carving) 완성도 분석. 턴의 깊이, G-Force, 슬립 최소화 여부 측정.
    - 감점 요인: 채터링(Chattering), 급제동(Brake), 정지(Stop) 등 세분화된 페널티 적용.
- **Flow Score (Stability, 1000점 만점):**
    - 주행 안정성 및 리듬 분석. 속도 유지력과 턴 연결의 부드러움 측정.
- **기본 메트릭:** Max Speed, Avg Speed, Run Count, Distance, Vertical Drop, Duration.

## 4. 데이터 대시보드 & 시각화 (Dashboard & Visualization)
- **Real-time Dashboard:** 네온 스타일 Dark UI, 현재 속도/슬로프/상태 실시간 표시.
- **Run Detail View:**
    - **Timeline:** 상태 기반 컬러 세그먼트(Riding-Neon/Lift-Grey) 및 햅틱 피드백 스크러버.
    - **Interactive Map:** 'Neon Glow' 스타일 경로(White Core + Neon Shadow) 및 상태별 오버레이.
    - **Bento Grid Stats:** 핵심 데이터를 강조하는 Bento UI 카드 배치.
    - **Charts:** 런별 속도 변화 그래프 (Swift Charts).

## 5. 소셜 & 공유 (Social Sharing)
- **Share Preview:** Instagram Story 최적화 프리뷰.
- **Photo Synthesis:** 사용자 사진 위에 주행 데이터(지도, 스코어, 배지) 예쁘게 합성.
- **Sticker Pasteboard:** "인스타그램에 붙여넣기"를 위한 투명 배경 스티커 복사 기능.
- **Exports:** GPX 파일 내보내기, 분석용 CSV/Log 내보내기.

## 6. 수익화 (Monetization / Pro)
- 상세 계획: `docs/monetization_plan.md` 참고.
- **Pro Features:** 상세 분석(Edge/Flow Breakdown), 리플레이, 고급 공유 템플릿.

## 7. 게이미피케이션 & 랭킹 (Gamification)
- **Ranking System:**
    - **Modes:** Technical(점수 기반) vs Mileage(거리/횟수 기반) 랭킹 스위칭.
    - **Cycles:** 시즌 랭킹 / 주간 랭킹.
    - **Podium UI:** 1~3위 강조 비주얼 (금/은/동 스타일).
- **Tier System:** 활동량(XP)에 따른 티어(Bronze ~ Diamond) 부여.

## 8. 인증 및 온보딩 (Auth & Onboarding)
- **Delayed Login (Guest-First):** 앱 실행 시 가입 강제 없이 즉시 메인 화면 진입.
- **Guest Mode:** 로컬 DB(SwiftData) 기반으로 기록/히스토리 기능 100% 사용 가능.
- **My Page Auth:** 마이페이지에서 가입(Google/Apple) 전환 지원.
- **Real Apple Sign In:** Full Name 캡처 및 Firebase Profile 연동 구현.

# 프로젝트 로드맵 (Roadmap to Launch)
1. **[Current Focus] UX/UI 폴리싱 (Polishing):**
    - Map & Timeline 시각화 고도화 (완료).
    - 메트릭 신뢰도 검증 및 엣지 케이스 처리.

2. **[Next Step] 수익화 모델 구현 (Monetization):**
    - **StoreKit 연동:** `docs/monetization_plan.md`에 정의된 구독 모델(Pro) 구현.
    - **Pro Gate:** 상세 분석, 3D 맵, 고급 공유 템플릿 잠금 처리.

3. **커뮤니티 및 멀티플레이어 (Community):**
    - **Global Leaderboard:** Firebase 연동, 주간/시즌 랭킹.
    - **Crew System:** 크루 생성 및 그룹 랭킹전.

4. **콘텐츠 확장 (Expansion):**
    - 국내 주요 리조트(용평, 휘닉스) 슬로프 DB 추가.


# 최근 이슈 및 해결 (Changlog Summary)
- 개발 일지로 분리: `docs/dev_log.md` 참고

# 임시 플래그 (런칭 전 제거)
- **프로 기능 강제 활성화:** `snow_recorder/ContentView.swift`의 `mainTabView` `.onAppear`에서 `FeatureFlags.proFeaturesEnabled = true` 설정. 런칭 전에 제거/비활성화 필요.
