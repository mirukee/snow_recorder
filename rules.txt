# 프로젝트 정체성 (Project Identity)
- 프로젝트명: Snow Record (스노우 레코드)
- 핵심 가치: '감성(Vibe)'과 'Flex'. 사용자가 스키장에서 자신의 기록을 힙하게 확인하고 공유하는 도구.

# 기술 스택 및 아키텍처 (Tech Stack)
- 플랫폼: iOS Native (Target iOS 17.0 이상), SwiftUI.
- 아키텍처: MVVM 패턴.
- 데이터 저장: Local-First (SwiftData).
    - 주요 모델: `RunSession` (주행 기록), `SlopeDatabase` (슬로프 정보).
- 핵심 프레임워크: 
    - CoreLocation (GPS/상태 기반 트래킹), 
    - MapKit (경로 시각화/커스텀 오버레이), 
    - SwiftData (영속성), 
    - PhotosUI/ShareLink (이미지 합성 및 공유), 
    - CoreMotion (기압계 - 고도 보정),
    - Charts (Swift Charts - 속도 그래프).

# 디자인 시스템 (Design System)
- **컨셉:** Cyberpunk / Near Future.
- **컬러 팔레트:**
    - Background: Real Black (#000000) ~ Dark Gray (#121212)
    - Primary Point: Neon Green (#6BF906)
- **타이포그래피:** SF Pro Heavy (헤드라인), SF Pro Rounded (데이터/숫자).
- **디자인 원칙:** AI(Stitch)가 제안한 디자인 시안을 픽셀 퍼펙트하게 구현. Bento Grid 레이아웃 활용.

# 로컬라이제이션 전략 (Hybrid)
- 라벨(Labels): 영어 (MAX SPEED, DISTANCE, RUN COUNT 등) - 힙한 느낌 강조.
- 데이터(Content): 한국어 우선 (하이원 리조트 - 제우스 2, 밸리 허브 등 / 런 시작 시간 등).

# 코딩 규칙 (Coding Rules)
- **모든 주석과 설명은 '한국어'로 작성한다.**
- **데이터 흐름:** `LocationManager`(상태/센서) -> `RecordManager`(세션/런 로직) -> `SwiftData`(저장) -> `Views`(표시).
- **배터리 최적화:**
    - `Riding`: 최고 정확도 (kCLLocationAccuracyBestForNavigation).
    - `Paused`: 고정밀 (kCLLocationAccuracyNearestTenMeters).
    - `OnLift`: 저전력 (kCLLocationAccuracyHundredMeters) + Sticky Logic + 리프트 하차 예측 부스트.
    - `Resting`: 고정밀 (kCLLocationAccuracyNearestTenMeters) - 빠른 리프트/이동 감지.

# 현재 개발 현황 (Implemented Features)

## 1. 핵심 트래킹 엔진 (Core Tracking)
- **상태 인식 알고리즘:** Riding / Paused / OnLift / Resting 4단계 자동 감지.
- **정밀 측정:**
    - GPS 기반 속도, 거리, 경로 기록.
    - **Barometer(기압계) 통합:** `CMAltimeter`를 활용한 정밀 Vertical Drop(하강 고도) 측정 및 GPS 고도 Drift 보정.
    - **Pending State Logic:** 상태 전환 시 Buffer(Pending Riding/Rest)를 두어 노이즈(잠깐의 멈춤 등) 필터링.
    - **Run(런) 정의:** 라이딩 시작 ~ 끝을 하나의 'Run'으로 그룹화, 최소 거리/속도 조건으로 유효 런 판정.

## 2. 슬로프 및 위치 인식 (Slope & Location)
- **Geo-Fencing DB:** 하이원 리조트 주요 슬로프(Zeus, Apollo, Hera 등) 및 리프트 좌표 DB (`SlopeDatabase`).
- **자동 감지:** 현재 위치 기반 슬로프명/구간 자동 매핑.
- **경로 분석:** 런별 주행 슬로프, 리프트 탑승 구간 분리 기록.

## 3. 고도화된 메트릭 & 스코어링 (Advanced Metrics)
- **Technical Score (Edge Score, 1000점 만점):**
    - 카빙(Carving) 완성도 분석. 턴의 깊이, G-Force, 슬립 최소화 여부 측정.
    - 감점 요인: 채터링(Chattering), 급제동(Brake), 정지(Stop) 등 세분화된 페널티 적용.
- **Flow Score (Stability, 1000점 만점):**
    - 주행 안정성 및 리듬 분석. 속도 유지력과 턴 연결의 부드러움 측정.
- **기본 메트릭:** Max Speed, Avg Speed, Run Count, Distance, Vertical Drop, Duration.

## 4. 데이터 대시보드 & 시각화 (Dashboard & Visualization)
- **Real-time Dashboard:** 네온 스타일 Dark UI, 현재 속도/슬로프/상태 실시간 표시.
- **Run Detail View:**
    - **Timeline:** 타임라인 기반 주행(실선)/리프트(점선)/휴식 이벤트 시각화.
    - **Interactive Map:** 속도에 따른 `GradientPolyline` (히트맵) 경로 오버레이.
    - **Bento Grid Stats:** 핵심 데이터를 강조하는 Bento UI 카드 배치.
    - **Charts:** 런별 속도 변화 그래프 (Swift Charts).

## 5. 소셜 & 공유 (Social Sharing)
- **Share Preview:** Instagram Story 최적화 프리뷰.
- **Photo Synthesis:** 사용자 사진 위에 주행 데이터(지도, 스코어, 배지) 예쁘게 합성.
- **Sticker Pasteboard:** "인스타그램에 붙여넣기"를 위한 투명 배경 스티커 복사 기능.
- **Exports:** GPX 파일 내보내기, 분석용 CSV/Log 내보내기.

## 6. 게이미피케이션 & 랭킹 (Gamification)
- **Ranking System:**
    - **Modes:** Technical(점수 기반) vs Mileage(거리/횟수 기반) 랭킹 스위칭.
    - **Cycles:** 시즌 랭킹 / 주간 랭킹.
    - **Podium UI:** 1~3위 강조 비주얼 (금/은/동 스타일).
- **Tier System:** 활동량(XP)에 따른 티어(Bronze ~ Diamond) 부여.

# 프로젝트 로드맵 (Roadmap)
1. **[Next Step] 커뮤니티 및 멀티플레이어 (Community):**
    - **글로벌 리더보드 연동:** Firebase 기반 전 세계 사용자 경쟁.
    - **크루(Crew) 시스템:** 소모임 기록 합산 및 크루 랭킹전.

2. **데이터 확장 (Expansion):**
    - 하이원 외 타 리조트(용평, 휘닉스 등) 슬로프 DB 구축.
    - 해외 리조트 지원 검토.

3. **플랫폼 확장 (Platform):**
    - **watchOS 앱:** 폰 없이 워치 단독 트래킹 및 실시간 피드백.
    - **Widget:** 잠금 화면/홈 화면 위젯.

# 최근 이슈 및 해결 (Changlog Summary)
- **(2026-01-28) 타임라인 & 지도 고도화:** 지도 경로에 타임스탬프를 매핑하여 라이딩/리프트 구간을 시각적으로 분리(실선/점선).
- **(2026-01-28) 메트릭 신뢰도 개선:** Flow Score 0점 버그 수정(최소 점수 보장), Chatter 감점 로직 완화, 속도 그래프 런 간 간섭 제거.
- **(2026-01-27) SwiftData 안정화:** 스키마 변경 시 마이그레이션 전략 수립 (Optional 필드 활용).
- **(2026-01-24) 점수 스케일 업:** 변별력을 위해 100점 -> 1000점 만점으로 변경.

# 임시 플래그 (런칭 전 제거)
- **프로 기능 강제 활성화:** `snow_recorder/ContentView.swift`의 `mainTabView` `.onAppear`에서 `FeatureFlags.proFeaturesEnabled = true` 설정. 런칭 전에 제거/비활성화 필요.
