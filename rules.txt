# 프로젝트 정체성 (Project Identity)
- 프로젝트명: Snow Record (스노우 레코드)
- 핵심 가치: '감성(Vibe)'과 'Flex'. 사용자가 스키장에서 자신의 기록을 힙하게 확인하고 공유하는 도구.

# 기술 스택 및 아키텍처 (Tech Stack)
- 플랫폼: iOS Native (Target iOS 17.0 이상), SwiftUI.
- 아키텍처: MVVM 패턴.
- 데이터 저장: Local-First (SwiftData).
    - 주요 모델: `RunSession` (주행 기록), `SlopeDatabase` (슬로프 정보).
- 핵심 프레임워크: CoreLocation (GPS), MapKit (경로 시각화), SwiftData (영속성), PhotosUI (이미지 합성).

# 디자인 시스템 (Design System)
- **컨셉:** Cyberpunk / Near Future.
- **컬러 팔레트:**
    - Background: Real Black (#000000) ~ Dark Gray (#121212)
    - Primary Point: Neon Green (#6BF906)
- **타이포그래피:** SF Pro Heavy (헤드라인), SF Pro Rounded (데이터/숫자).
- **디자인 원칙:** AI(Stitch)가 제안한 디자인 시안을 픽셀 퍼펙트하게 구현.

# 로컬라이제이션 전략 (Hybrid)
- 라벨(Labels): 영어 (MAX SPEED, DISTANCE, RUN COUNT 등) - 힙한 느낌 강조.
- 데이터(Content): 한국어 우선 (하이원 리조트 - 제우스 2, 밸리 허브 등).

# 코딩 규칙 (Coding Rules)
- **모든 주석과 설명은 '한국어'로 작성한다.**
- **데이터 흐름:** `LocationManager`(상태 인식) -> `RecordManager`(세션 기록) -> `SwiftData`(저장) -> `Views`(표시).
- **배터리 최적화:**
    - `Riding`: 최고 정확도 (kCLLocationAccuracyBestForNavigation).
    - `Paused`: 고정밀 (kCLLocationAccuracyNearestTenMeters).
    - `OnLift`: 저전력 (kCLLocationAccuracyHundredMeters) + Sticky Logic.
    - `Resting`: 고정밀 (kCLLocationAccuracyNearestTenMeters) - 빠른 리프트/이동 감지 목적.

# 현재 개발 현황 (Implemented Features)
- **1. 핵심 트래킹 엔진:**
    - GPS 기반 실시간 속도, 거리 측정.
    - 상태 인식 알고리즘 (Riding / Paused / OnLift / Resting) 구현 완료.
    - 타임라인 이벤트(Riding/Lift/Rest/Pause) 세분화 기록 및 시각화 데이터 구축.
    - Vertical Drop (하강 고도) 계산 로직 포함.
- **2. 슬로프 인식 시스템:**
    - 하이원 리조트 주요 슬로프 좌표 DB 구축 (`SlopeDatabase`).
    - 현재 위치 기반 슬로프명 자동 감지.
- **3. 데이터 대시보드:**
    - 실시간 주행 정보 표시 (속도, 슬로프명).
    - 네온 스타일의 Dark UI 적용.
- **4. 기록 관리 (History):**
    - `RunSession` 모델 기반 SwiftData 저장/로드.
    - GPX 파일 내보내기 및 공유 기능.
    - 주행 경로 지도 시각화 (`GradientPolyline` 히트맵 적용).
- **5. 소셜 프리뷰 (Share):**
    - 주행 데이터 + 사진 합성 기능 (`SharePreviewView`).
    - **Instagram Story 공유 고도화:** 붙여넣기 보드를 이용한 스티커 공유 로직 구현 완료.
    - 커스텀 배경 이미지 핀치/줌 조절 및 고해상도 이미지 (1080x1920) 내보내기.
- **6. 게이미피케이션 (Gamification):**
    - **랭킹 시스템 구현:** Technical Score(Edge/Flow) 및 Mileage 기반 랭킹 모드 스위칭 구현 완료.
    - **티어(Tier) 시스템:** 누적 기록에 따른 등급(Bronze ~ Diamond) 및 XP 시스템 `ProfileView` 연동 완료.

# 프로젝트 로드맵 (Roadmap)
1. **[Next Step] 커뮤니티 및 멀티플레이어 (Community):**
    - **글로벌 리더보드 연동:** 현재 로컬 기반 데이터 집계를 넘어, Firebase 등을 통한 실제 전 세계 사용자 간의 랭킹 경쟁 기능.
    - **크루(Crew) 시스템:** 소모임 단위의 기록 합산 및 크루 랭킹전.

2. **슬로프 데이터 확장 (Expansion):**
    - 하이원 리조트 슬로프 데이터 보강 (Zeus, Apollo, Hera, Victoria 등 주요 슬로프 좌표 입력 완료).
    - 용평, 휘닉스 파크 등 타 리조트 데이터베이스 구조 설계 및 추가.

3. **안정화 및 고도화 (Optimization):**
    - **워치 앱(watchOS) 연동:** 폰을 꺼내지 않고도 손목에서 실시간 속도 및 상태 확인.
    - **현장 테스트:** 실제 스키장에서 슬로프 인식 정확도 및 배터리 소모량 검증/보정.

# 이슈 및 해결 (Issues & Resolutions)
- **SwiftData 마이그레이션 이슈 (2026-01-24):**
    - 현상: 프로퍼티 추가 시 데이터 유실. 해결: Default Value 지정 필수.
- **SwiftData 컨테이너 로드 실패/마이그레이션 오류 (2026-01-27):**
    - 현상: 스키마 변경 후 `loadIssueModelContainer` 발생, 기존 기록/신규 저장이 UI에 표시되지 않음.
    - 원인: 필수 속성(Non-Optional) 추가로 마이그레이션 검증 실패(예: `edgeRawScore`).
    - 해결: 신규 필드는 기본값 또는 Optional로 설계, 필요 시 MigrationPlan 추가. **패치 시 반드시 데이터 로드 확인 로그 검증.**
- **필드 테스트 이슈 정리 (2026-01-27):**
    - 1) 삭제된 런(40초 이하 추정)이 세션 총계(런카운트/스피드/버티컬)에 반영됨.
    - 2) 특정 기기에서 정상 런이 간헐적으로 인식되지 않음(상태 전환/정확도/슬로프 판정 영향 추정).
    - 3) 히스토리뷰에서 세션 미표시(스키마 이슈 해결 후 1/27 데이터 소실).
    - 4) Flow 점수 0점 고정(라이딩 샘플 누락/필터 조건 과도 가능성).
    - 5) 슬로프 기준 측정 대비 거리/듀레이션/버티컬 차이 발생(슬로프 로직 의존도 과다 가능성).
- **Edge/Flow Score 스케일 조정 (2026-01-24):**
    - 현상: 기존 100점 만점으로 표시되던 점수가 변별력이 낮음.
    - 해결: **1000점 만점**으로 스케일 상향 조정 및 UI(/1000) 업데이트 완료.
- **전체 화면 지도 히트맵 에러 (2026-01-24):**
    - 현상: `MKGradientPolyline` 타입 부재로 인한 컴파일 에러.
    - 해결: `MKPolyline` 커스텀 서브클래스(`GradientPolyline`)를 생성하여 `MKGradientPolylineRenderer`와 연동 성공.

# 답변
- 답변은 한국어로 한다.
