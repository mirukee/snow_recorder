#!/usr/bin/env python3
"""
ZEUS II ìŠ¬ë¡œí”„ ì¥ì¶• ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
êµ½ì´ì¹˜ëŠ” ë¶€ë¶„(U-turn)ì´ ì¥ì¶• í›„ë³´ê°€ ë˜ëŠ”ì§€ ê²€ì¦
"""

import math
from itertools import combinations

# ZEUS II boundary ì¢Œí‘œ (SlopeDatabase.swiftì—ì„œ ì¶”ì¶œ)
ZEUS_II_BOUNDARY = [
    (37.181471757439496, 128.81785474414573),
    (37.18112989732103, 128.81811555779626),
    (37.18056683022375, 128.81819127788856),
    (37.18032551446852, 128.81883069199625),
    (37.18029870155961, 128.8196972663788),
    (37.18019144982712, 128.82070686760085),
    (37.180312108015244, 128.8218090156031),
    (37.180332217694655, 128.82222126943617),
    (37.17968200201949, 128.82240636299434),
    (37.179467496651895, 128.82272607004717),
    (37.17924665569785, 128.82272163926302),
    (37.17937210335512, 128.82333456792657),
    (37.179322820372136, 128.82354824947828),
    (37.179090557532064, 128.8239158217403),
    (37.17888647684468, 128.82455451080045),
    (37.178838769591096, 128.8247840396824),  # â† í˜„ì¬ topPoint
    (37.17888647684468, 128.82496699748555),
    (37.17901634643704, 128.8251333227625),
    (37.179284036116286, 128.82512666975026),
    (37.17961735677716, 128.82503046302054),
    (37.18023754232699, 128.82447826310403),
    (37.18032235363049, 128.82442503901478),
    (37.1800202129274, 128.82485748473312),
    (37.179927450188856, 128.82515687023078),
    (37.18008647195718, 128.82543297018822),
    (37.18027464728374, 128.8254263171777),
    (37.18055558422394, 128.8253165424954),
    (37.18088422617038, 128.8250038492837),
    (37.181242020146755, 128.82460799512654),
    (37.18137422301804, 128.82456823307945),
    (37.18173996557995, 128.82484433303853),
    (37.182224270762646, 128.82501275301973),
    (37.18285164057977, 128.8249653604023),
    (37.1834499612077, 128.82491432089762),
    (37.18393449737765, 128.8248930825796),
    (37.18443405875131, 128.82508265304944),
    (37.18479130119498, 128.82530503379223),
    (37.18545059949777, 128.82561490621623),
    (37.185941437766004, 128.82587374281758),
    (37.18630157887503, 128.8260742487622),
    (37.18675755968887, 128.82609612227623),
    (37.187065417789924, 128.82613257813665),
    (37.18747492570394, 128.8262820467553),
    (37.187811823757045, 128.82645703488248),
    (37.188238753202484, 128.8267123119419),
    (37.18848852006654, 128.82692375592757),
    (37.18931042200228, 128.8280611770807),  # ë„ì°©ì  ê·¼ì²˜
    (37.18948467834376, 128.82698572417303),  # â† í˜„ì¬ bottomPoint
    (37.18881961234132, 128.8265081565441),
    (37.188293941564666, 128.82608162298885),
    (37.18771796108382, 128.8256610570408),
    (37.187194679163994, 128.82538225323663),
    (37.18614057531943, 128.82522631223077),
    (37.18550434109186, 128.82499948879757),
    (37.184853445906825, 128.82456921397812),
    (37.18436402709716, 128.8242384298029),
    (37.183938606632566, 128.82419117492213),
    (37.18355028750824, 128.82418745979163),
    (37.182834969682744, 128.82448044005935),
    (37.18208199623152, 128.8243859302953),
    (37.18169100854726, 128.82393653666702),
    (37.181438759456825, 128.82381367397363),
    (37.18102838227122, 128.82393653666702),
    (37.18044876527888, 128.8247490876525),
    (37.18070854758457, 128.82398828405024),
    (37.180520299626295, 128.82381344098815),
    (37.17993296298057, 128.82415840162685),
    (37.17945998518336, 128.82445759504554),
    (37.17980431398722, 128.82369298745942),
    (37.17986107133166, 128.82309934802828),
    (37.18003512692219, 128.82277640817858),
    (37.180553507500534, 128.82255319975042),
    (37.18075963293634, 128.822443740968),
    (37.180718011382865, 128.82137518912123),
    (37.18059059125952, 128.82097936646),
    (37.180625631822764, 128.8204316127468),
    (37.180714825908524, 128.81968794712276),
    (37.18080401988982, 128.81889630307086),
    (37.18109071579707, 128.81859244181953),
    (37.18150790161454, 128.81829713681464),
    (37.181469675991565, 128.8178653309689),
]

def haversine_distance(coord1, coord2):
    """ë‘ ì¢Œí‘œ ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚° (ë¯¸í„°)"""
    R = 6371000  # ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
    lat1, lon1 = math.radians(coord1[0]), math.radians(coord1[1])
    lat2, lon2 = math.radians(coord2[0]), math.radians(coord2[1])
    
    dlat = lat2 - lat1
    dlon = lon2 - lon1
    
    a = math.sin(dlat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dlon/2)**2
    c = 2 * math.asin(math.sqrt(a))
    
    return R * c

def find_longest_axis(boundary):
    """í´ë¦¬ê³¤ì—ì„œ ê°€ì¥ ë¨¼ ë‘ ì  ì°¾ê¸°"""
    max_distance = 0
    max_pair = None
    max_indices = None
    
    for i, j in combinations(range(len(boundary)), 2):
        dist = haversine_distance(boundary[i], boundary[j])
        if dist > max_distance:
            max_distance = dist
            max_pair = (boundary[i], boundary[j])
            max_indices = (i, j)
    
    return max_distance, max_pair, max_indices

def analyze_zeus2():
    print("=" * 70)
    print("ğŸ¿ ZEUS II ìŠ¬ë¡œí”„ ì¥ì¶• ë¶„ì„")
    print("=" * 70)
    
    # 1. ì¥ì¶• ì°¾ê¸°
    max_dist, max_pair, max_indices = find_longest_axis(ZEUS_II_BOUNDARY)
    
    print(f"\nğŸ“ ì¥ì¶• ë¶„ì„ ê²°ê³¼:")
    print(f"   ìµœì¥ ê±°ë¦¬: {max_dist:.2f}m")
    print(f"   ì  ì¸ë±ìŠ¤: {max_indices[0]} â†” {max_indices[1]}")
    print(f"\n   Point A (ì¸ë±ìŠ¤ {max_indices[0]}):")
    print(f"      ìœ„ë„: {max_pair[0][0]:.10f}")
    print(f"      ê²½ë„: {max_pair[0][1]:.10f}")
    print(f"\n   Point B (ì¸ë±ìŠ¤ {max_indices[1]}):")
    print(f"      ìœ„ë„: {max_pair[1][0]:.10f}")
    print(f"      ê²½ë„: {max_pair[1][1]:.10f}")
    
    # 2. í˜„ì¬ ì„¤ì •ëœ topPoint/bottomPointì™€ ë¹„êµ
    current_top = (37.178838769591096, 128.8247840396824)  # ì¸ë±ìŠ¤ 15
    current_bottom = (37.18948467834376, 128.82698572417303)  # ì¸ë±ìŠ¤ 47
    current_dist = haversine_distance(current_top, current_bottom)
    
    print(f"\nğŸ“Œ í˜„ì¬ ì„¤ì •ëœ Start/Finish:")
    print(f"   topPoint (ì¸ë±ìŠ¤ 15): lat={current_top[0]:.10f}")
    print(f"   bottomPoint (ì¸ë±ìŠ¤ 47): lat={current_bottom[0]:.10f}")
    print(f"   ê±°ë¦¬: {current_dist:.2f}m")
    
    # 3. ìœ„ë„ ë¶„ì„ (ë‚¨ìª½ = ìœ„ë„ê°€ ë‚®ìŒ)
    print(f"\nğŸ§­ ìœ„ë„ ë¹„êµ (ë‚¨ìª½ = ìœ„ë„ ë‚®ìŒ):")
    
    # ëª¨ë“  ì ì˜ ìœ„ë„ ì •ë ¬
    sorted_by_lat = sorted(enumerate(ZEUS_II_BOUNDARY), key=lambda x: x[1][0])
    
    print(f"\n   ğŸ“ ê°€ì¥ ë‚¨ìª½ 5ê°œ ì :")
    for idx, coord in sorted_by_lat[:5]:
        print(f"      ì¸ë±ìŠ¤ {idx:2d}: lat={coord[0]:.10f} (lon={coord[1]:.8f})")
    
    print(f"\n   ğŸ“ ê°€ì¥ ë¶ìª½ 5ê°œ ì :")
    for idx, coord in sorted_by_lat[-5:]:
        print(f"      ì¸ë±ìŠ¤ {idx:2d}: lat={coord[0]:.10f} (lon={coord[1]:.8f})")
    
    # 4. ì¥ì¶•ìœ¼ë¡œ ì„ íƒëœ ì ì˜ ì—­í•  ë¶„ì„
    print(f"\n" + "=" * 70)
    print("âš ï¸  ë¬¸ì œì  ë¶„ì„:")
    print("=" * 70)
    
    # ì¥ì¶• ì ë“¤ì˜ ìœ„ë„ í™•ì¸
    point_a_lat = max_pair[0][0]
    point_b_lat = max_pair[1][0]
    
    # ëˆ„ê°€ Start(ë‚¨=ìœ„ë„ ë‚®ìŒ)ì´ê³  ëˆ„ê°€ Finish(ë¶=ìœ„ë„ ë†’ìŒ)ì¸ì§€
    if point_a_lat < point_b_lat:
        start_point, start_idx = max_pair[0], max_indices[0]
        finish_point, finish_idx = max_pair[1], max_indices[1]
    else:
        start_point, start_idx = max_pair[1], max_indices[1]
        finish_point, finish_idx = max_pair[0], max_indices[0]
    
    print(f"\n   ì¥ì¶• ê¸°ë°˜ ìë™ ê³„ì‚° ê²°ê³¼:")
    print(f"   Start (ë‚¨ìª½, ì¸ë±ìŠ¤ {start_idx}): lat={start_point[0]:.10f}")
    print(f"   Finish (ë¶ìª½, ì¸ë±ìŠ¤ {finish_idx}): lat={finish_point[0]:.10f}")
    
    # í˜„ì¬ ì„¤ì •ê³¼ ë¹„êµ
    if abs(start_point[0] - current_top[0]) > 0.0001:
        print(f"\n   âŒ í˜„ì¬ topPointì™€ ì¥ì¶• Startê°€ ë‹¤ë¦…ë‹ˆë‹¤!")
        print(f"      í˜„ì¬ topPoint: lat={current_top[0]:.10f} (ì¸ë±ìŠ¤ 15)")
        print(f"      ì¥ì¶• Start:    lat={start_point[0]:.10f} (ì¸ë±ìŠ¤ {start_idx})")
        print(f"      ì°¨ì´: {abs(start_point[0] - current_top[0]) * 111000:.1f}m")
    else:
        print(f"\n   âœ… í˜„ì¬ topPointì™€ ì¥ì¶• Startê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.")
    
    # 5. U-turn ì§€ì  ë¶„ì„
    print(f"\n" + "=" * 70)
    print("ğŸ”„ U-turn ì§€ì  (êµ½ì´ì¹˜ëŠ” ë¶€ë¶„) ë¶„ì„:")
    print("=" * 70)
    
    # ì‚¬ì§„ì—ì„œ í‘œì‹œëœ U-turn ì§€ì ë“¤ (ëŒ€ëµì ì¸ ì¸ë±ìŠ¤ ë²”ìœ„)
    uturn_candidates = [
        (11, 12, 13),  # ì²« ë²ˆì§¸ U-turn (ì¸ë±ìŠ¤ 11~13 ê·¼ì²˜)
        (20, 21, 22, 23, 24),  # ë‘ ë²ˆì§¸ U-turn
    ]
    
    print(f"\n   U-turn í›„ë³´ ì§€ì ë“¤:")
    for i, indices in enumerate(uturn_candidates, 1):
        print(f"\n   U-turn #{i}:")
        for idx in indices:
            if idx < len(ZEUS_II_BOUNDARY):
                coord = ZEUS_II_BOUNDARY[idx]
                print(f"      ì¸ë±ìŠ¤ {idx}: lat={coord[0]:.10f}")

if __name__ == "__main__":
    analyze_zeus2()
