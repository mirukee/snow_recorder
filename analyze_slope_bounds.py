#!/usr/bin/env python3
"""
슬로프 폴리곤 고도 정밀 분석 스크립트
상위/하위 5개 지점을 출력하여 고도 분포를 확인합니다.
"""

import requests
import json

ZEUS_II_BOUNDARY = [
    (37.181471757439496, 128.81785474414573),
    (37.18112989732103, 128.81811555779626),
    (37.18056683022375, 128.81819127788856),
    (37.18032551446852, 128.81883069199625),
    (37.18029870155961, 128.8196972663788),
    (37.18019144982712, 128.82070686760085),
    (37.180312108015244, 128.8218090156031),
    (37.180332217694655, 128.82222126943617),
    (37.17968200201949, 128.82240636299434),
    (37.179467496651895, 128.82272607004717),
    (37.17924665569785, 128.82272163926302),
    (37.17937210335512, 128.82333456792657),
    (37.179322820372136, 128.82354824947828),
    (37.179090557532064, 128.8239158217403),
    (37.17888647684468, 128.82455451080045),
    (37.178838769591096, 128.8247840396824),
    (37.17888647684468, 128.82496699748555),
    (37.17901634643704, 128.8251333227625),
    (37.179284036116286, 128.82512666975026),
    (37.17961735677716, 128.82503046302054),
    (37.18023754232699, 128.82447826310403),
    (37.18032235363049, 128.82442503901478),
    (37.1800202129274, 128.82485748473312),
    (37.179927450188856, 128.82515687023078),
    (37.18008647195718, 128.82543297018822),
    (37.18027464728374, 128.8254263171777),
    (37.18055558422394, 128.8253165424954),
    (37.18088422617038, 128.8250038492837),
    (37.181242020146755, 128.82460799512654),
    (37.18137422301804, 128.82456823307945),
    (37.18173996557995, 128.82484433303853),
    (37.182224270762646, 128.82501275301973),
    (37.18285164057977, 128.8249653604023),
    (37.1834499612077, 128.82491432089762),
    (37.18393449737765, 128.8248930825796),
    (37.18443405875131, 128.82508265304944),
    (37.18479130119498, 128.82530503379223),
    (37.18545059949777, 128.82561490621623),
    (37.185941437766004, 128.82587374281758),
    (37.18630157887503, 128.8260742487622),
    (37.18675755968887, 128.82609612227623),
    (37.187065417789924, 128.82613257813665),
    (37.18747492570394, 128.8262820467553),
    (37.187811823757045, 128.82645703488248),
    (37.188238753202484, 128.8267123119419),
    (37.18848852006654, 128.82692375592757),
    (37.18931042200228, 128.8280611770807),
    (37.18948467834376, 128.82698572417303),
    (37.18881961234132, 128.8265081565441),
    (37.188293941564666, 128.82608162298885),
    (37.18771796108382, 128.8256610570408),
    (37.187194679163994, 128.82538225323663),
    (37.18614057531943, 128.82522631223077),
    (37.18550434109186, 128.82499948879757),
    (37.184853445906825, 128.82456921397812),
    (37.18436402709716, 128.8242384298029),
    (37.183938606632566, 128.82419117492213),
    (37.18355028750824, 128.82418745979163),
    (37.182834969682744, 128.82448044005935),
    (37.18208199623152, 128.8243859302953),
    (37.18169100854726, 128.82393653666702),
    (37.181438759456825, 128.82381367397363),
    (37.18102838227122, 128.82393653666702),
    (37.18044876527888, 128.8247490876525),
    (37.18070854758457, 128.82398828405024),
    (37.180520299626295, 128.82381344098815),
    (37.17993296298057, 128.82415840162685),
    (37.17945998518336, 128.82445759504554),
    (37.17980431398722, 128.82369298745942),
    (37.17986107133166, 128.82309934802828),
    (37.18003512692219, 128.82277640817858),
    (37.180553507500534, 128.82255319975042),
    (37.18075963293634, 128.822443740968),
    (37.180718011382865, 128.82137518912123),
    (37.18059059125952, 128.82097936646),
    (37.180625631822764, 128.8204316127468),
    (37.180714825908524, 128.81968794712276),
    (37.18080401988982, 128.81889630307086),
    (37.18109071579707, 128.81859244181953),
    (37.18150790161454, 128.81829713681464),
    (37.181469675991565, 128.8178653309689),
]

def fetch_elevations(locations):
    url = "https://api.open-elevation.com/api/v1/lookup"
    payload = {
        "locations": [
            {"latitude": lat, "longitude": lon}
            for lat, lon in locations
        ]
    }
    
    try:
        response = requests.post(url, json=payload, timeout=30)
        response.raise_for_status()
        data = response.json()
        return [r["elevation"] for r in data["results"]]
    except Exception as e:
        print(f"API Error: {e}")
        return []

def main():
    print("ZEUS II 슬로프 고도 정밀 분석 중...")
    elevations = fetch_elevations(ZEUS_II_BOUNDARY)
    
    if not elevations:
        print("고도 데이터 조회 실패")
        return

    # 데이터 결합
    points = []
    for i, ((lat, lon), alt) in enumerate(zip(ZEUS_II_BOUNDARY, elevations)):
        points.append({
            "index": i,
            "lat": lat,
            "lon": lon,
            "alt": alt
        })

    # 고도순 정렬
    sorted_by_alt = sorted(points, key=lambda x: x["alt"], reverse=True)
    
    print(f"\n[고도가 가장 높은 Top 5]")
    for p in sorted_by_alt[:5]:
        print(f"Index {p['index']:>2} | 고도 {p['alt']:>4.1f}m | Lat {p['lat']:.5f}")
        
    print(f"\n[고도가 가장 낮은 Bottom 5]")
    for p in sorted_by_alt[-5:]:
        print(f"Index {p['index']:>2} | 고도 {p['alt']:>4.1f}m | Lat {p['lat']:.5f}")
        
    # 수동 설정 포인트의 고도 확인
    manual_top = next((p for p in points if p["index"] == 15), None)
    
    if manual_top:
        print(f"\n[기존 수동 Top Point (Index 15)]")
        print(f"고도 {manual_top['alt']:.1f}m | Rank {sorted_by_alt.index(manual_top) + 1}위 / {len(points)}")

if __name__ == "__main__":
    main()
